<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frontend Docker avec PostgreSQL</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Docker Compose App</h1>
    <h2>Gestion des Produits PostgreSQL</h2>

    <button onclick="loadProducts()">Afficher les produits</button>
    <button onclick="addProduct()">Ajouter un produit</button>

    <table id="productTable">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Prix</th>
          <th>Catégorie</th>
          <th>Quantité</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const API = window.location.hostname === 'localhost'
  ? 'http://localhost:3000/api/products'
  : 'http://backend:3000/api/products';

const tableBody = document.querySelector('#productTable tbody');

async function loadProducts() {
  try {
    const res = await fetch(API);
    const products = await res.json();
    tableBody.innerHTML = '';
    products.forEach(p => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${p.name}</td>
        <td>${p.price}</td>
        <td>${p.category || ''}</td>
        <td>${p.quantity}</td>
      `;
      tableBody.appendChild(row);
    });
  } catch (err) {
    alert('Erreur lors du chargement des produits : ' + err.message);
  }
}

async function addProduct() {
  const product = {
    name: "Produit " + Math.floor(Math.random()*1000),
    price: Math.floor(Math.random()*100),
    category: "test",
    quantity: Math.floor(Math.random()*20)
  };

  try {
    const res = await fetch(API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(product)
    });
    const newProduct = await res.json();
    alert("✅ Produit ajouté : " + newProduct.name);
    loadProducts();
  } catch (err) {
    alert('Erreur lors de l’ajout du produit : ' + err.message);
  }
}

loadProducts();
</script>
</body>
</html>

